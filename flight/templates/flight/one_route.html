{% extends 'base.html' %}

{% block title %}
{{ route.code }}
{% endblock %}

{% block content %}
    <table class="table">
        <thead>
            <tr>
                <th>Рейс</th>
                <th>Вылет</th>
                <th>Прилёт</th>
                <th>Самолёт</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ route.code }}</td>
                <td>{{ route.airport_out }}</td>
                <td>{{ route.airport_in }}</td>
                <td>{{ route.plane }}</td>
            </tr>
        </tbody>
    </table>
{#    {{ test }}#}
{#    {{ route.airport_out.lat }}#}
{#    {{ route.airport_out.lng }}#}
{% endblock %}

{% block gmap %}
    <div id="map"></div>

        <script>

          var marker1, marker2;
          var poly, geodesicPoly;



          function initMap() {
            var airport_out = {lat: {{ route.airport_out.lat }}, lng: {{ route.airport_out.lng }}};
            var airport_in = {lat: {{ route.airport_in.lat }}, lng: {{ route.airport_in.lng }}};

            function flyway_center() {
                var lat_center = ((airport_out['lat'] + airport_in['lat']) / 2);
                var lng_center = ((airport_out['lng'] + airport_in['lng']) / 2);
                var way_center = [lat_center , lng_center];
                console.log({lat:lat_center, lng:lng_center});
                return {lat:lat_center, lng:lng_center};
            }

            var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 4,
{#              center: {lat: 34, lng: -40.605},#}

{#              styles: [#}
{#                                  {#}
{#                                    "elementType": "geometry",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#212121"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "elementType": "labels.icon",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "elementType": "labels.text.fill",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#757575"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "elementType": "labels.text.stroke",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#212121"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "administrative",#}
{#                                    "elementType": "geometry",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#757575"#}
{#                                      },#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "administrative.country",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "on"#}
{#                                      },#}
{#                                      {#}
{#                                        "weight": 1#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "administrative.country",#}
{#                                    "elementType": "labels.text.fill",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#9e9e9e"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "administrative.land_parcel",#}
{#                                    "elementType": "labels",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "administrative.locality",#}
{#                                    "elementType": "labels.text.fill",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#bdbdbd"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "poi",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "poi",#}
{#                                    "elementType": "labels.text",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "poi",#}
{#                                    "elementType": "labels.text.fill",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#757575"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "poi.business",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "poi.park",#}
{#                                    "elementType": "geometry",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#181818"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "poi.park",#}
{#                                    "elementType": "labels.text.fill",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#616161"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "poi.park",#}
{#                                    "elementType": "labels.text.stroke",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#1b1b1b"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "road",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "road",#}
{#                                    "elementType": "geometry.fill",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#2c2c2c"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "road",#}
{#                                    "elementType": "labels.icon",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "road",#}
{#                                    "elementType": "labels.text.fill",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#8a8a8a"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "road.arterial",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "road.arterial",#}
{#                                    "elementType": "geometry",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#373737"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "road.highway",#}
{#                                    "elementType": "geometry",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#3c3c3c"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "road.highway",#}
{#                                    "elementType": "labels",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "road.highway.controlled_access",#}
{#                                    "elementType": "geometry",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#4e4e4e"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "road.local",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "road.local",#}
{#                                    "elementType": "labels",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "road.local",#}
{#                                    "elementType": "labels.text.fill",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#616161"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "transit",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "visibility": "off"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "transit",#}
{#                                    "elementType": "labels.text.fill",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#757575"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "water",#}
{#                                    "elementType": "geometry",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#000000"#}
{#                                      }#}
{#                                    ]#}
{#                                  },#}
{#                                  {#}
{#                                    "featureType": "water",#}
{#                                    "elementType": "labels.text.fill",#}
{#                                    "stylers": [#}
{#                                      {#}
{#                                        "color": "#3d3d3d"#}
{#                                      }#}
{#                                    ]#}
{#                                  }#}
{#                                ]#}
            });
            var iconBase = '{{ STATIC_PREFIX }}flight/images/map_labels/';
{#            map.controls[google.maps.ControlPosition.TOP_CENTER].push(#}
{#                document.getElementById('info'));#}

            marker1 = new google.maps.Marker({
              map: map,
              position: airport_out,
              icon: iconBase + "out_bs.png"
            });
{##}
            marker2 = new google.maps.Marker({
              map: map,
              position: airport_in,
              icon: iconBase + "in_bs.png"
            });

            marker3 = new google.maps.Marker({
              map: map,
              position: flyway_center(),
              icon: iconBase + "in_bs.png"
            });

            var bounds = new google.maps.LatLngBounds(
                marker1.getPosition(), marker2.getPosition(), marker3.getPosition());
            map.fitBounds(bounds);

            google.maps.event.addListener(marker1, 'position_changed', update);
            google.maps.event.addListener(marker2, 'position_changed', update);
            google.maps.event.addListener(marker3, 'position_changed', update);

{#            Прямая линия между точками#}
            poly = new google.maps.Polyline({
{#              strokeColor: '#FF0000',#}
{#              strokeOpacity: 1.0,#}
{#              strokeWeight: 3,#}
{#              map: map#}
            });

{#              Сферическая интерполяция#}
            geodesicPoly = new google.maps.Polyline({
              strokeColor: '#35de32',
              strokeOpacity: 1.0,
              strokeWeight: 3,
              geodesic: true,
              map: map
            });

            update();
          }


          function update() {
            var path = [marker1.getPosition(), marker2.getPosition()];
                poly.setPath(path);
                geodesicPoly.setPath(path);



            var heading = google.maps.geometry.spherical.computeHeading(path[0], path[1]);
            document.getElementById('heading').value = heading;
            document.getElementById('origin').value = path[0].toString();
            document.getElementById('destination').value = path[1].toString();
          }
        map.setCenter(markersBounds.getCenter(), map.fitBounds(markersBounds));
        </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBEyU7CLrolAMH0Ou8oi_FXxbQ1TVLpKPI&libraries=geometry&callback=initMap"
        async defer></script>



{% endblock %}